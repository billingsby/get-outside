var map,radius,activity="hiking",latitude,longitude,trails="";function initialize(i){latitude=39.833,longitude=-98.583,map=L.map("map").setView([latitude,longitude],4),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',id:"billingsby.p8gk9ma9",accessToken:"pk.eyJ1IjoiYmlsbGluZ3NieSIsImEiOiJjaWwybmpzZHEzZzZ5dW1rczR1NnQzOWVyIn0.kI9i7wGvEUIUOuKzZiGRDg"}).addTo(map)}var geoCode=function(i){var t,e={address:i};(new google.maps.Geocoder).geocode(e,function(i,t){latitude=i[0].geometry.location.lat(),longitude=i[0].geometry.location.lng(),console.log(latitude),console.log(longitude),map.panTo(new L.LatLng(latitude,longitude)),map.setZoom(10),getTrails(latitude,longitude)})},starWidth=function(i){var t;return Math.round(i/5*100)},showInfo=function(i){var t='<div class="popup"><div id="title"><h3>'+i.name+"</h3></div>",e='<div id="thumb"><img id="thumbnail" src="'+i.activities[0].thumbnail+'"></div>',a='<div id="stats"><ul class="list-unstyled list-inline"><li id="distance"><h5>'+i.activities[0].length+" Miles</h5></li>",n,s='<li><div class="rating_bar"><div  class="rating" style="width:'+starWidth(i.activities[0].rating)+';"></div></div></li>',l,o=i.activities[0].description.replace(/[<]br[^>]*[>]/gi,"");o=o.replace(/&lt;br \/&gt;/g,""),console.log(o);var r='<div id="description"><h4>Description</h4><p id="trail-description">'+o+"</p></div></div>";if(null==i.activities[0].thumbnail)var d=t+a+s+r;else var d=t+e+a+s+r;return d},getTrails=function(i,t){var e={lat:i,lon:t,radius:radius};function a(i){i.setRequestHeader("X-Mashape-Key: VulSm4HnjbmshLEx7fwnu5mRk0Qcp1yZyzFjsneibRFOUNRzdA"),i.setRequestHeader("Accept","application, json")}$.ajax({url:"https://trailapi-trailapi.p.mashape.com/trails/explore/",beforeSend:a,data:e,type:"GET"}).done(function(s){$.each(s.places,function(i,t){var e=t.lat,a=t.lon,n=showInfo(t);marker=new L.marker([e,a]).addTo(map),console.log(s.status,s.headers,s.body),marker.bindPopup(n,{closeButton:!1,minWidth:320})})})},mySlider=$("#radius").slider(),radius=mySlider.slider("getValue");$(".controls").on("slide",mySlider,function(){radius=mySlider.slider("getValue"),$("#radius-num").text(radius)}),$(document).ready(function(){initialize(),$(".controls").on("click","#bike, #hike",function(){$(this).addClass("active"),$(this).siblings().removeClass("active"),$("#bike").hasClass("active")?activity="mountain biking":$("#hike").hasClass("active")&&(activity="hiking")}),$(".controls").on("click","#find-trails",function(i){i.preventDefault(),$(".leaflet-shadow-pane").html(""),$(".leaflet-marker-pane").html("");var t=$("#address").val();geoCode(t)})});